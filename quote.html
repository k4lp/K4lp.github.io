<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/site/styles.css">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BOM Quote Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <div class="nav__item">
                <a href="index.html" class="back-link">Back to Tools</a>
            </div>
        </nav>

        <header class="page-header">
            <div>
                <h1 class="page-header__title">BOM Quote Generator</h1>
                <p class="lead">Excel processing with API integration and row selection</p>
            </div>
            <div class="page-header__meta">
                <div class="meta" id="configStatus">Settings: <span id="configCount">Closed</span></div>
                <div class="meta" id="authStatus" style="display: none;">ðŸ”„ Authenticating...</div>
            </div>
        </header>

        <!-- Configuration Panel -->
        <section class="mb-48" id="configPanel" style="display: none;">
            <div class="card">
                <div class="card__header">
                    <h2 class="card__title">Configuration Panel</h2>
                    <button id="toggleConfig" class="button button--ghost">Minimize</button>
                </div>
                
                <!-- Digikey Credentials -->
                <div class="p-16">
                    <h3 class="mb-16">Digikey API Credentials</h3>
                    <div class="grid-12 gap-16 mb-16">
                        <div class="col-span-6">
                            <div class="form__group">
                                <label class="label">Client ID</label>
                                <input type="text" id="dkClientId" autocomplete="off" class="input">
                            </div>
                        </div>
                        <div class="col-span-6">
                            <div class="form__group">
                                <label class="label">Client Secret</label>
                                <input type="password" id="dkClientSecret" autocomplete="off" class="input">
                            </div>
                        </div>
                    </div>
                    <div class="grid-12 gap-16 mb-16">
                        <div class="col-span-4">
                            <div class="form__group">
                                <label class="label">Environment</label>
                                <select id="dkEnvironment" class="select">
                                    <option value="production">Production</option>
                                    <option value="sandbox">Sandbox</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-span-4">
                            <div class="form__group">
                                <label class="label">Locale</label>
                                <select id="dkLocale" class="select">
                                    <option value="US/USD">US / USD</option>
                                    <option value="CA/CAD">CA / CAD</option>
                                    <option value="GB/GBP">GB / GBP</option>
                                    <option value="DE/EUR">DE / EUR</option>
                                    <option value="JP/JPY">JP / JPY</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-span-4">
                            <div class="form__group">
                                <label class="label">Status</label>
                                <div id="dkStatus" class="badge badge--neutral">Inactive</div>
                            </div>
                        </div>
                    </div>
                    <div class="button-group mb-24">
                        <button id="saveDkCreds" class="button button--primary">Save & Test</button>
                        <button id="clearDkCreds" class="button button--ghost text-error">Clear</button>
                    </div>

                    <!-- Mouser Credentials -->
                    <h3 class="mb-16">Mouser API Credentials</h3>
                    <div class="grid-12 gap-16 mb-16">
                        <div class="col-span-12">
                            <div class="form__group">
                                <label class="label">API Key</label>
                                <input type="password" id="mouserApiKey" autocomplete="off" class="input">
                            </div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="saveMouserCreds" class="button button--primary">Save & Test</button>
                        <button id="clearMouserCreds" class="button button--ghost text-error">Clear</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- File Upload Section -->
        <section class="mb-48">
            <h2 class="mb-16">Excel File Processing</h2>
            <div class="card mb-16">
                <div class="card__header">
                    <h3 class="card__title">File Upload</h3>
                    <button id="showConfig" class="button button--ghost">Settings</button>
                </div>
                <div class="p-16">
                    <div class="form__group mb-16">
                        <label class="label">Select Excel File (.xlsx, .xls)</label>
                        <input type="file" id="fileInput" accept=".xlsx,.xls" class="input">
                    </div>
                    <div id="fileInfo" class="hidden">
                        <div class="file-info-panel">
                            <h3>File Information</h3>
                            <div class="kv">
                                <div class="kv__pair">
                                    <div class="kv__key">Name</div>
                                    <div class="kv__val" id="fileName"></div>
                                </div>
                                <div class="kv__pair">
                                    <div class="kv__key">Size</div>
                                    <div class="kv__val" id="fileSize"></div>
                                </div>
                                <div class="kv__pair">
                                    <div class="kv__key">Sheets</div>
                                    <div class="kv__val" id="sheetCount"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sheet Selection -->
            <div id="sheetSelection" class="card mb-16 hidden">
                <div class="card__header">
                    <h3 class="card__title">Sheet Selection</h3>
                </div>
                <div class="p-16">
                    <div class="form__group mb-16">
                        <label class="label">Select Worksheet</label>
                        <select id="sheetSelect" class="select">
                            <option value="">-- Select Sheet --</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Data Preview and Row Selection -->
            <div id="dataPreview" class="card mb-16 hidden">
                <div class="card__header">
                    <h3 class="card__title">Data Preview & Row Selection</h3>
                    <div class="button-group">
                        <button id="selectDataRows" class="button button--primary">Select Data Rows</button>
                        <button id="clearRowSelection" class="button button--ghost">Clear Selection</button>
                    </div>
                </div>
                <div class="p-16">
                    <div class="alert alert--info mb-16">
                        <div class="alert__msg">
                            Click "Select Data Rows" to choose which rows contain your MPN, Manufacturer, and Quantity data.
                        </div>
                    </div>
                    
                    <!-- Row Selection Info -->
                    <div id="rowSelectionInfo" class="file-info-panel mb-16 hidden">
                        <h3>Selected Data Configuration</h3>
                        <div class="kv">
                            <div class="kv__pair">
                                <div class="kv__key">MPN Column</div>
                                <div class="kv__val" id="selectedMpnCol">Not selected</div>
                            </div>
                            <div class="kv__pair">
                                <div class="kv__key">Manufacturer Column</div>
                                <div class="kv__val" id="selectedMfgCol">Not selected</div>
                            </div>
                            <div class="kv__pair">
                                <div class="kv__key">Quantity Column</div>
                                <div class="kv__val" id="selectedQtyCol">Not selected</div>
                            </div>
                            <div class="kv__pair">
                                <div class="kv__key">Data Rows</div>
                                <div class="kv__val" id="selectedDataRows">Not selected</div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div id="previewTable"></div>
                    </div>
                </div>
            </div>

            <!-- Column Mapping -->
            <div id="columnMapping" class="card mb-16 hidden">
                <div class="card__header">
                    <h3 class="card__title">Output Column Configuration</h3>
                    <button id="addColumn" class="button button--primary">Add Column</button>
                </div>
                <div class="p-16">
                    <div class="alert alert--info mb-16">
                        <div class="alert__msg">
                            Add columns to fetch additional data from Digikey and Mouser APIs.
                        </div>
                    </div>
                    <div id="columnList" class="mapping-grid">
                        <!-- Dynamic column mapping items will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Processing Controls -->
            <div id="processingControls" class="card mb-16 hidden">
                <div class="card__header">
                    <h3 class="card__title">Processing</h3>
                </div>
                <div class="p-16">
                    <div class="form__group mb-16">
                        <label class="label">Concurrency per API</label>
                        <input type="number" id="concurrency" value="3" min="1" max="10" class="input">
                        <div class="form__help">Recommended: 2-5 requests per second</div>
                    </div>
                    <div class="button-group">
                        <button id="processFile" class="button button--primary" disabled>Process File</button>
                        <button id="exportResult" class="button button--ghost" disabled>Export Excel</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Progress Section -->
        <section id="progressSection" class="mb-48 hidden">
            <h2 class="mb-16">Processing Progress</h2>
            <div class="card">
                <div class="p-16">
                    <div id="progressText" class="font-mono text-xs mb-8"></div>
                    <div class="progress mb-16">
                        <div id="progressBar" class="progress__bar"></div>
                    </div>
                    <div class="stats">
                        <div class="text-center">
                            <div class="stat__value" id="statProcessed">0</div>
                            <div class="stat__label">Processed</div>
                        </div>
                        <div class="text-center">
                            <div class="stat__value" id="statSuccess">0</div>
                            <div class="stat__label">Success</div>
                        </div>
                        <div class="text-center">
                            <div class="stat__value" id="statWarning">0</div>
                            <div class="stat__label">Warning</div>
                        </div>
                        <div class="text-center">
                            <div class="stat__value" id="statError">0</div>
                            <div class="stat__label">Error</div>
                        </div>
                        <div class="text-center">
                            <div class="stat__value" id="statRate">0/s</div>
                            <div class="stat__label">Rate</div>
                        </div>
                        <div class="text-center">
                            <div class="stat__value" id="statETA">--</div>
                            <div class="stat__label">ETA</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section class="mb-48">
            <h2 class="mb-16">Results</h2>
            <div id="resultsArea">
                <div id="emptyResults" class="card">
                    <div class="p-24 text-center text-gray-500">No results yet</div>
                </div>
                <div id="resultsTable" class="results-table hidden"></div>
            </div>
        </section>

        <!-- Log Section -->
        <section class="mb-48">
            <h2 class="mb-16">Processing Log</h2>
            <div id="log" class="log">Quote generator initialized</div>
        </section>
    </div>

    <!-- Row Selection Modal -->
    <div id="rowSelectionModal" class="overlay">
        <div class="modal modal--lg">
            <div class="modal__close">
                <button id="closeRowModal" class="button button--ghost">Ã—</button>
            </div>
            <h2 class="mb-16">Configure Data Rows and Columns</h2>
            
            <div class="mb-24">
                <h3 class="mb-12">Step 1: Select Column Headers</h3>
                <div class="grid-12 gap-16 mb-16">
                    <div class="col-span-4">
                        <div class="form__group">
                            <label class="label">MPN Column</label>
                            <select id="mpnColumnSelect" class="select">
                                <option value="">-- Select MPN Column --</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-span-4">
                        <div class="form__group">
                            <label class="label">Manufacturer Column</label>
                            <select id="mfgColumnSelect" class="select">
                                <option value="">-- Select Manufacturer Column --</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-span-4">
                        <div class="form__group">
                            <label class="label">Quantity Column</label>
                            <select id="qtyColumnSelect" class="select">
                                <option value="">-- Select Quantity Column --</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-24">
                <h3 class="mb-12">Step 2: Select Data Rows</h3>
                <div class="alert alert--info mb-16">
                    <div class="alert__msg">
                        Click on row numbers to select/deselect data rows. Selected rows will be processed.
                    </div>
                </div>
                <div class="table-container" style="max-height: 300px;">
                    <div id="rowSelectionTable"></div>
                </div>
            </div>

            <div class="button-group">
                <button id="confirmRowSelection" class="button button--primary">Confirm Selection</button>
                <button id="cancelRowSelection" class="button button--ghost">Cancel</button>
            </div>
        </div>
    </div>

    <script src="js/quote/quote-controller.js"></script>
</body>
</html>